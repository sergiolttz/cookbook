{% extends '__base.html' %}

{% block content %}
<div class="recipe-detail">
    <h2>{{ recipe.title }}</h2>

    {% if average_rating %}
    <p><strong>Calificación Promedio:</strong> {{ average_rating|floatformat:1 }}</p>
    {% else %}
    <p>Esta receta aún no ha sido calificada.</p>
    {% endif %}

    {% if user.is_authenticated %}
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Calificar</button>
    </form>
    {% else %}
    <p>Inicia sesión para calificar esta receta.</p>
    {% endif %}

    {% if user.is_authenticated and user == recipe.author %}
    <a href="{% url 'recipe-update' pk=recipe.pk %}">Editar Receta</a>
    <a href="{% url 'recipe-delete' pk=recipe.pk %}">Eliminar Receta</a>
    {% endif %}

    {% if recipe.image %}
    <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" style="max-width: 400px;">
    {% endif %}

    <p><strong>Descripción:</strong> {{ recipe.description }}</p>
    <p><strong>Tiempo requerido:</strong> {{ recipe.time_required }}</p>
    <p><strong>Porciones:</strong> {{ recipe.servings }}</p>
    <p><strong>Autor:</strong> {{ recipe.author.username }}</p>

    <h3>Ingredientes:</h3>
    <ul>
        {% for ingredient in recipe.recipeingredient_set.all %}
        <li>{{ ingredient.quantity }} {{ ingredient.get_measurement_display }} de {{ ingredient.ingredient.name }}</li>
        {% endfor %}
    </ul>

    <h3>Pasos:</h3>
    <ol>
        {% for step in recipe.steps.all %}
        <li>{{ step.description }}</li>
        {% endfor %}
    </ol>

    <button id="copy-link">Copiar Enlace</button>
    <input type="text" id="recipe-link" value="{{ request.build_absolute_uri }}" readonly style="display: none;">
    <a href="{% url 'recipe-pdf' pk=recipe.pk %}" class="btn btn-primary">Descargar PDF</a>
    <a href="{% url 'recipes-list' %}">Volver a la lista de recetas</a>
</div>

<script>
    document.getElementById('copy-link').addEventListener('click', function () {
        var recipeLink = document.getElementById('recipe-link');
        recipeLink.style.display = 'block';
        recipeLink.select();
        document.execCommand('copy');
        alert('Copiado al portapapeles');
    });
</script>
{% endblock content %}