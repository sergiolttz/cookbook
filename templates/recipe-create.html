{% extends '__base.html' %}

{% block content %}
<h2>Crear Nueva Receta</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {{ form.title.label_tag }} {{ form.title }}
    {{ form.description.label_tag }} {{ form.description }}
    {{ form.image.label_tag }} {{ form.image }}
    {{ form.time_required.label_tag }} {{ form.time_required }}
    {{ form.servings.label_tag }} {{ form.servings }}
    {{ form.calification.label_tag }} {{ form.calification }}

    <h3>Agregar Ingrediente</h3>
    <div id="ingredients-container">
        <div class="ingredient-row">
            <label for="ingredient_name">Nombre Ingrediente</label>
            <input type="text" name="ingredient_name" id="ingredient_name_0">
            <label for="ingredient_quantity">Cantidad</label>
            <input type="text" name="ingredient_quantity" id="ingredient_quantity_0"
                oninput="this.value = this.value.replace(/[^0-9./]/g, '').replace(/(\..*)\./g, '$1');">
            <label for="ingredient_measurement">Medida</label>
            <select name="ingredient_measurement" id="ingredient_measurement_0">
                <option value="gr">Gramos</option>
                <option value="kg">Kilogramos</option>
                <option value="ml">Mililitros</option>
                <option value="l">Litros</option>
                <option value="tz">Taza</option>
                <option value="cdta">Cucharadita</option>
                <option value="cda">Cucharada</option>
                <option value="u">Unidad</option>
            </select>
            <button type="button" class="remove-ingredient">Eliminar</button>
        </div>
    </div>
    <button type="button" id="add-ingredient">Agregar Ingrediente</button>
    
    <h3>Pasos a Seguir</h3>
    <div id="steps-container">
        <div class="step-row">
            <label for="step_description">Paso 1:</label>
            <textarea name="step_description" id="step_description_0"></textarea>
            <button type="button" class="remove-step">Eliminar</button>
        </div>
    </div>
    <button type="button" id="add-step">Agregar Paso</button>
    
    <button type="submit">Guardar Receta</button>

</form> 

<a href="{% url 'recipes-list' %}">Volver a la lista de recetas</a>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ingredientsContainer = document.getElementById('ingredients-container');
        const addIngredientButton = document.getElementById('add-ingredient');

        addIngredientButton.addEventListener('click', function () {
            const timestamp = new Date().getTime();
            const newRow = document.createElement('div');
            newRow.classList.add('ingredient-row');
            newRow.innerHTML = `
                <label for="ingredient_name">Nombre Ingrediente</label>
                <input type="text" name="ingredient_name" id="ingredient_name_${timestamp}">
                <label for="ingredient_quantity">Cantidad</label>
                <input type="text" name="ingredient_quantity" id="ingredient_quantity_${timestamp}" onchange="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                <label for="ingredient_measurement">Medida</label>
                <select name="ingredient_measurement" id="ingredient_measurement_${timestamp}">
                    <option value="gr">Gramos</option>
                    <option value="kg">Kilogramos</option>
                    <option value="ml">Mililitros</option>
                    <option value="l">Litros</option>
                    <option value="tz">Taza</option>
                    <option value="cdta">Cucharadita</option>
                    <option value="cda">Cucharada</option>
                    <option value="u">Unidad</option>
                </select>
                <button type="button" class="remove-ingredient">Eliminar</button>
            `;
            ingredientsContainer.appendChild(newRow);

            newRow.querySelector('.remove-ingredient').addEventListener('click', function () {
                newRow.remove();
            });
        });

        ingredientsContainer.querySelector('.remove-ingredient').addEventListener('click', function () {
            this.parentElement.remove();
        });
                const stepsContainer = document.getElementById('steps-container');
        const addStepButton = document.getElementById('add-step');
        let stepCount = 1;

        addStepButton.addEventListener('click', function () {
            stepCount++;
            const timestamp = new Date().getTime();
            const newRow = document.createElement('div');
            newRow.classList.add('step-row');
            newRow.innerHTML = `
                <label for="step_description">Paso ${stepCount}:</label>
                <textarea name="step_description" id="step_description_${timestamp}"></textarea>
                <button type="button" class="remove-step">Eliminar</button>
            `;
            stepsContainer.appendChild(newRow);

            newRow.querySelector('.remove-step').addEventListener('click', function () {
                newRow.remove();
            });
        });

        stepsContainer.querySelector('.remove-step').addEventListener('click', function () {
            this.parentElement.remove();
        });
    });
</script>
{% endblock content %}